<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />
<title>Gladiator</title>
<style>
  :root{
    --bg:#0b0b0f;
    --bg-soft:#111119;
    --panel:#141420;
    --ink:#e8e8f0;
    --muted:#a6a6b3;
    --red:#ff1f3d;
    --red-2:#ff3b58;
    --accent:#ff2f4a;
    --line:#1f2030;
    --green:#34e5a6;
    --yellow:#ffd36a;
    --tt:#00e2ff;
  }
  *{box-sizing:border-box}
  html,body{height:100%;background:var(--bg);color:var(--ink);font-family: ui-rounded, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans", "Liberation Sans", sans-serif; margin:0}
  /* Lightning corner effect */
  body::before, body::after{
    content:"";
    position:fixed; z-index:0; width:45vmin; height:45vmin;
    background:
      radial-gradient(closest-side, rgba(255,31,61,.35), transparent 60%),
      conic-gradient(from 0deg, rgba(255,80,100,.35), transparent 40%, rgba(255,31,61,.6), transparent 70%);
    filter: blur(18px) saturate(140%);
    animation: arc 8s linear infinite;
    pointer-events:none;
  }
  body::before{ top:-10vmin; left:-12vmin; }
  body::after{ bottom:-12vmin; right:-10vmin; animation-direction: reverse; }
  @keyframes arc{ to{ transform:rotate(360deg)} }

  /* Layout */
  .app{ position:relative; min-height:100%; padding:88px 16px 98px; isolation:isolate; }
  header{
    position:fixed; top:0; left:0; right:0; height:72px;
    background: linear-gradient(180deg,#12121a, #0d0d14);
    border-bottom:1px solid var(--line);
    display:flex; align-items:center; justify-content:center; gap:16px;
    z-index:10;
  }
  .brand{
    position:absolute; left:50%; transform:translateX(-50%);
    font-weight:900; letter-spacing:.22em; font-size:20px; color:#fff;
    text-shadow:0 0 18px rgba(255,47,74,.35);
  }
  .nav{
    position:absolute; inset:0; display:flex; align-items:center; justify-content:space-between; padding:0 10px;
  }
  .icon-btn{
    width:52px; height:52px; border-radius:14px; border:1px solid var(--line);
    background:linear-gradient(180deg,#161621,#11111a);
    display:grid; place-items:center; cursor:pointer; transition:.15s transform ease, .15s filter ease;
    box-shadow:inset 0 0 0 1px rgba(255,47,74,.08);
  }
  .icon-btn:active{ transform:scale(.96) }
  .icon-btn.active{ outline:2px solid rgba(255,47,74,.55); box-shadow:0 0 0 6px rgba(255,47,74,.08) inset; }
  .icon{ width:26px; height:26px; fill: none; stroke:#ff4b63; stroke-width:2.2; }

  /* Content sections */
  .grid{ display:grid; gap:18px; max-width:980px; margin:0 auto; }
  .cards{ display:grid; grid-template-columns: repeat(auto-fit,minmax(260px,1fr)); gap:18px; }
  .card{
    background:linear-gradient(180deg,#151522,#11111a); border:1px solid var(--line); border-radius:18px; overflow:hidden;
    box-shadow: 0 8px 30px rgba(0,0,0,.3), inset 0 0 0 1px rgba(255,47,74,.05);
  }
  .thumb{ background:#0d0d16; height:160px; display:grid; place-items:center; border-bottom:1px solid var(--line); }
  .card-body{ padding:14px 14px 16px }
  .title{ font-weight:800; letter-spacing:.08em; font-size:18px; }
  .muted{ color:var(--muted); font-size:13px; margin-top:6px }
  .row{ display:flex; gap:10px; align-items:center; margin-top:12px }
  .btn{
    padding:10px 14px; border-radius:12px; border:1px solid var(--line);
    background:linear-gradient(180deg,#1a1a28,#131320); color:#fff; font-weight:700; letter-spacing:.06em;
    cursor:pointer; transition: .15s transform ease, .15s background ease;
  }
  .btn.red{ background:linear-gradient(180deg,#ff2347,#e41836); border-color:#c20f29; box-shadow:0 4px 18px rgba(255,35,71,.35) }
  .btn:active{ transform: translateY(1px) }

  /* Section panels */
  section{ display:none }
  section.active{ display:block }

  /* Modal */
  .modal{
    position:fixed; inset:0; display:none; align-items:center; justify-content:center; padding:18px; z-index:20;
    background: rgba(0,0,0,.55);
  }
  .modal.show{ display:flex }
  .sheet{ width:min(680px, 96vw); background:linear-gradient(180deg,#151521,#101018); border:1px solid var(--line); border-radius:18px; overflow:hidden }
  .sheet .hd{ display:flex; align-items:center; justify-content:space-between; padding:14px 16px; border-bottom:1px solid var(--line) }
  .sheet .bd{ padding:16px }
  .x{ background:#191927; border:1px solid var(--line); color:#fff; border-radius:10px; padding:8px 12px; cursor:pointer }
  .fld{ display:grid; gap:8px; margin:10px 0 }
  .fld label{ font-size:13px; color:var(--muted) }
  .inp, .inp-num, .txt{
    width:100%; background:#10101a; color:#fff; border:1px solid var(--line); padding:12px 12px; border-radius:12px;
  }
  .txt{ min-height:90px; resize:vertical }
  .two{ display:grid; grid-template-columns:1fr 1fr; gap:10px }
  .note{ color:var(--muted); font-size:12px }

  /* Account & Contact */
  .stack{ display:grid; gap:12px; max-width:760px; margin:0 auto }
  .bar{ display:flex; gap:8px; align-items:center }
  .chip{ padding:7px 10px; background:#171729; border:1px solid var(--line); border-radius:999px; font-size:12px; color:var(--muted) }
  .list{ display:grid; gap:10px }
  .msg{
    background:linear-gradient(180deg,#141425,#101018); border:1px solid var(--line); border-radius:14px; padding:10px 12px;
  }

  /* Footer socials */
  footer{
    position:fixed; bottom:0; left:0; right:0; height:72px; display:flex; align-items:center; justify-content:center; gap:14px;
    border-top:1px solid var(--line); background:linear-gradient(180deg,#0f0f16,#0b0b11); z-index:9;
  }
  .link{
    display:flex; gap:8px; align-items:center; padding:8px 12px; border-radius:999px; border:1px solid var(--line);
    background:#12121c; color:#fff; text-decoration:none; font-size:13px;
  }
  .dot{ width:10px; height:10px; border-radius:50%; background:var(--red); box-shadow:0 0 10px rgba(255,47,74,.9) }
  .notif{ font-size:12px; color:#ff9aa8 }

  /* Splash (Loading) */
  .splash{
    position:fixed; inset:0; display:grid; place-items:center; background:radial-gradient(1200px 700px at 50% 80%, rgba(255,47,74,.08), transparent), #0a0a0e; z-index:30;
  }
  .sp-title{ font-size:36px; font-weight:900; letter-spacing:.25em; color:#ff304b; text-shadow:0 0 20px rgba(255,50,80,.55) }
  .spinner{ margin-top:14px; width:62px; height:62px; border-radius:50%; border:3px solid rgba(255,47,74,.35); border-top-color:#ff2f4a; animation: spin 1.1s linear infinite }
  @keyframes spin{ to{ transform:rotate(360deg)} }

  /* SVG thumbs look “pixelated” */
  svg{ image-rendering: pixelated; }

  /* Chat (AI) */
  .chat{ max-width:900px; margin:0 auto; display:grid; gap:12px }
  .chatbar{ display:flex; gap:8px }
  .inpt{ flex:1; background:#10101a; border:1px solid var(--line); border-radius:12px; padding:12px; color:#fff }
  .bubble{ background:linear-gradient(180deg,#151524,#0f0f18); border:1px solid var(--line); border-radius:14px; padding:10px 12px }
  .who{ font-weight:800; letter-spacing:.06em }
  .ai-tag{ color:var(--tt) }

  /* Music list */
  .song{ display:flex; align-items:center; justify-content:space-between; gap:10px; background:linear-gradient(180deg,#151524,#101018); border:1px solid var(--line); border-radius:12px; padding:8px 10px }
  .song .name{ font-weight:700 }
  .song a{ color:#fff; text-decoration:none; font-size:12px; opacity:.9 }

  /* Small screens */
  @media (max-width:540px){
    .title{ font-size:16px }
    .thumb{ height:140px }
  }
</style>
</head>
<body>

<!-- Splash -->
<div class="splash" id="splash">
  <div style="text-align:center">
    <div class="sp-title">hello spartan</div>
    <div class="spinner"></div>
  </div>
</div>

<header>
  <div class="nav">
    <div style="display:flex; gap:10px">
      <button class="icon-btn" data-tab="home" id="btnHome" title="Home">
        <svg class="icon" viewBox="0 0 24 24"><path d="M3 10.5 12 3l9 7.5M6 9.5V21h12V9.5"/></svg>
      </button>
      <button class="icon-btn" data-tab="about" id="btnAbout" title="About">
        <svg class="icon" viewBox="0 0 24 24"><circle cx="12" cy="12" r="9"/><path d="M12 8.5h.01M11 12h1v4"/></svg>
      </button>
      <button class="icon-btn" data-tab="ai" id="btnAI" title="AI">
        <svg class="icon" viewBox="0 0 24 24"><rect x="4" y="6" width="16" height="12" rx="3"/><path d="M8 10h.01M16 10h.01M9 15h6"/></svg>
      </button>
    </div>
    <div class="brand">GLADIATOR</div>
    <div style="display:flex; gap:10px">
      <button class="icon-btn" data-tab="music" id="btnMusic" title="Music">
        <svg class="icon" viewBox="0 0 24 24"><path d="M9 18a3 3 0 1 1-2-2.83V6l12-2v9.17A3 3 0 1 1 17 15"/></svg>
      </button>
      <button class="icon-btn" data-tab="contact" id="btnContact" title="Contact">
        <svg class="icon" viewBox="0 0 24 24"><path d="M4 5h16v12H6l-2 2V5z"/><path d="M9 10h6M9 13h6M9 7h6"/></svg>
      </button>
      <button class="icon-btn" data-tab="account" id="btnAccount" title="Account">
        <svg class="icon" viewBox="0 0 24 24"><circle cx="12" cy="8" r="4"/><path d="M4 21a8 8 0 0 1 16 0"/></svg>
      </button>
    </div>
  </div>
</header>

<div class="app">
  <section id="home" class="active">
    <div class="grid">
      <div class="cards">
        <!-- COD Mobile -->
        <div class="card">
          <div class="thumb">
            <svg width="100%" height="100%" viewBox="0 0 320 160">
              <defs>
                <linearGradient id="g1" x1="0" x2="1">
                  <stop offset="0" stop-color="#ff2347"/><stop offset="1" stop-color="#ff6f8a"/>
                </linearGradient>
              </defs>
              <rect x="0" y="0" width="320" height="160" fill="#0f0f16"/>
              <rect x="10" y="10" width="300" height="140" rx="10" fill="#161628" stroke="#2a2a3e"/>
              <g stroke="url(#g1)" stroke-width="3" fill="none">
                <path d="M22 120 L70 40 L118 120 Z"/>
                <path d="M128 120 L176 40 L224 120 Z"/>
                <path d="M234 120 L282 40 L300 70"/>
              </g>
              <text x="160" y="95" text-anchor="middle" fill="url(#g1)" style="font: 900 26px sans-serif; letter-spacing:6px">CALL OF DUTY</text>
              <text x="160" y="128" text-anchor="middle" fill="#fff" opacity=".8" style="font: 700 14px monospace; letter-spacing:6px">MOBILE</text>
            </svg>
          </div>
          <div class="card-body">
            <div class="title">CALL OF DUTY MOBILE</div>
            <div class="muted">Competitive FPS on mobile.</div>
            <div class="row">
              <button class="btn red" onclick="openGame('Call of Duty Mobile')">Open</button>
              <button class="btn" onclick="shareGame('Call of Duty Mobile')">Share</button>
            </div>
          </div>
        </div>

        <!-- Delta Force -->
        <div class="card">
          <div class="thumb">
            <svg width="100%" height="100%" viewBox="0 0 320 160">
              <defs>
                <linearGradient id="g2" x1="0" x2="1">
                  <stop offset="0" stop-color="#ff2347"/><stop offset="1" stop-color="#ff9aa8"/>
                </linearGradient>
              </defs>
              <rect width="320" height="160" fill="#0f0f16"/>
              <rect x="10" y="10" width="300" height="140" rx="10" fill="#151526" stroke="#2a2a3e"/>
              <g stroke="url(#g2)" stroke-width="3" fill="none">
                <rect x="26" y="92" width="54" height="28"/>
                <rect x="88" y="70" width="64" height="50"/>
                <rect x="168" y="50" width="84" height="68"/>
                <rect x="264" y="32" width="36" height="86"/>
              </g>
              <text x="160" y="100" text-anchor="middle" fill="url(#g2)" style="font: 900 26px sans-serif; letter-spacing:6px">DELTA FORCE</text>
            </svg>
          </div>
          <div class="card-body">
            <div class="title">DELTA FORCE</div>
            <div class="muted">Classic tactical action.</div>
            <div class="row">
              <button class="btn red" onclick="openGame('Delta Force')">Open</button>
              <button class="btn" onclick="shareGame('Delta Force')">Share</button>
            </div>
          </div>
        </div>

        <!-- PUBG Mobile -->
        <div class="card">
          <div class="thumb">
            <svg width="100%" height="100%" viewBox="0 0 320 160">
              <defs>
                <linearGradient id="g3" x1="0" x2="1">
                  <stop offset="0" stop-color="#ff2347"/><stop offset="1" stop-color="#ffd36a"/>
                </linearGradient>
              </defs>
              <rect width="320" height="160" fill="#0f0f16"/>
              <rect x="10" y="10" width="300" height="140" rx="10" fill="#151524" stroke="#2a2a3e"/>
              <g stroke="url(#g3)" stroke-width="3" fill="none">
                <circle cx="80" cy="85" r="26"/>
                <rect x="120" y="60" width="160" height="50" rx="8"/>
                <path d="M140 115 h120" />
              </g>
              <text x="160" y="100" text-anchor="middle" fill="url(#g3)" style="font: 900 26px sans-serif; letter-spacing:6px">PUBG MOBILE</text>
            </svg>
          </div>
          <div class="card-body">
            <div class="title">PUBG MOBILE</div>
            <div class="muted">Battle royale, squad up.</div>
            <div class="row">
              <button class="btn red" onclick="openGame('PUBG Mobile')">Open</button>
              <button class="btn" onclick="shareGame('PUBG Mobile')">Share</button>
            </div>
          </div>
        </div>
      </div>

      <div class="row" id="videoNoticeRow" style="display:none">
        <div class="notif">Gladiator posted new videos • Choose a platform:</div>
        <a class="link" id="ytLink" href="#" target="_blank">
          <span class="dot"></span><span id="ytName">YouTube</span>
        </a>
        <a class="link" id="igLink" href="#" target="_blank">
          <span class="dot"></span><span id="igName">Instagram</span>
        </a>
        <a class="link" id="ttLink" href="#" target="_blank">
          <span class="dot"></span><span id="ttName">TikTok</span>
        </a>
      </div>
    </div>
  </section>

  <section id="about">
    <div class="grid">
      <div class="card">
        <div class="card-body">
          <div class="title">About Gladiator</div>
          <p class="muted" style="margin-top:10px">
            eSports content, daily uploads, collaborations, and squad play.  
            Only verified accounts can request matches and send messages.
          </p>
          <div class="row">
            <span class="chip">Theme: Red/Black</span>
            <span class="chip">Secure OTP (simulated)</span>
            <span class="chip">Admin-only management</span>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- AI PANEL -->
  <section id="ai">
    <div class="grid">
      <div class="card">
        <div class="card-body">
          <div class="title">AI Assistant <span class="ai-tag">[GLADIATOR • Offline]</span></div>
          <p class="muted">Talk in English or Persian. Greetings, advice, Q&A, gaming tips…</p>
          <div class="chat" id="chatBox">
            <div class="bubble"><div class="who ai-tag">AI</div><div>Hi! / سلام! I’m here—how can I help?</div></div>
          </div>
          <div class="chatbar" style="margin-top:10px">
            <input id="aiInput" class="inpt" placeholder="Type a message… / یک پیام بنویس…" />
            <button class="btn red" id="sendAI">Send</button>
          </div>
          <div class="row" style="margin-top:6px">
            <button class="btn" onclick="quickAI('سلام')">سلام</button>
            <button class="btn" onclick="quickAI('Help with PUBG tactics')">PUBG tactics</button>
            <button class="btn" onclick="quickAI('برنامه امشب چیه؟')">برنامه امشب؟</button>
            <button class="btn" onclick="quickAI('What time can we play?')">Time?</button>
          </div>
          <div class="note" id="aiNote" style="margin-top:8px"></div>
        </div>
      </div>
    </div>
  </section>

  <section id="contact">
    <div class="stack">
      <div class="card">
        <div class="card-body">
          <div class="title">Contact Admin</div>
          <p class="muted">Send a direct message (requires sign-in).</p>
          <div class="fld">
            <label>Subject</label>
            <input class="inp" id="msgSubj" placeholder="Collab / Scrim / Question">
          </div>
          <div class="fld">
            <label>Message</label>
            <textarea class="txt" id="msgBody" placeholder="Type your message..."></textarea>
          </div>
          <div class="row">
            <button class="btn red" onclick="sendMessage()">Send</button>
            <div class="note" id="msgNote"></div>
          </div>
        </div>
      </div>

      <!-- Inbox (local preview) -->
      <div class="card">
        <div class="card-body">
          <div class="title">Inbox (local)</div>
          <div class="list" id="inbox"></div>
        </div>
      </div>
    </div>
  </section>

  <section id="music">
    <div class="grid">
      <div class="card">
        <div class="card-body">
          <div class="title">Music</div>
          <p class="muted">Sign in to listen. Only admin can upload.</p>
          <div id="musicAdmin" style="display:none">
            <div class="two">
              <div class="fld">
                <label>Select audio file</label>
                <input id="musicFile" type="file" accept="audio/*" />
              </div>
              <div class="fld">
                <label>Actions</label>
                <button class="btn" onclick="addMusic()">Upload</button>
              </div>
            </div>
            <div class="note">Only admin (code: vortex)</div>
          </div>
          <div id="musicList" class="list" style="margin-top:12px"></div>
          <div class="note" id="musicNote"></div>
        </div>
      </div>
    </div>
  </section>

  <section id="account">
    <div class="stack">
      <div class="card">
        <div class="card-body">
          <div class="title">Create Account</div>
          <div class="fld">
            <label>Phone number</label>
            <input id="accPhone" class="inp" placeholder="+98..." inputmode="tel">
          </div>
          <div class="row">
            <button class="btn" onclick="sendOTP()">Send Code</button>
            <div class="note" id="otpSentNote"></div>
          </div>
          <div class="two">
            <div class="fld">
              <label>OTP code</label>
              <input id="accOTP" class="inp-num" placeholder="4-digit" maxlength="6" inputmode="numeric">
            </div>
            <div class="fld">
              <label>Display name</label>
              <input id="accName" class="inp" placeholder="Your gamer name">
            </div>
          </div>
          <div class="fld">
            <label>Admin code (optional) — type <b>vortex</b> to become admin</label>
            <input id="accAdminCode" class="inp" placeholder="vortex">
          </div>
          <div class="row">
            <button class="btn red" onclick="verifyOTP()">Create / Sign In</button>
            <div class="note" id="accNote"></div>
          </div>
        </div>
      </div>

      <!-- Admin controls -->
      <div class="card">
        <div class="card-body">
          <div class="title">Admin Panel</div>
          <div class="note" id="adminNote">Locked (sign in as admin using code “vortex”).</div>

          <div id="adminPanel" style="display:none; margin-top:14px">
            <div class="title" style="font-size:16px">Social & Video Links</div>
            <div class="two">
              <div class="fld"><label>YouTube name</label><input id="ytNameInp" class="inp" placeholder="YouTube"/></div>
              <div class="fld"><label>YouTube link</label><input id="ytLinkInp" class="inp" placeholder="https://..."/></div>
            </div>
            <div class="two">
              <div class="fld"><label>Instagram name</label><input id="igNameInp" class="inp" placeholder="Instagram"/></div>
              <div class="fld"><label>Instagram link</label><input id="igLinkInp" class="inp" placeholder="https://..."/></div>
            </div>
            <div class="two">
              <div class="fld"><label>TikTok name</label><input id="ttNameInp" class="inp" placeholder="TikTok"/></div>
              <div class="fld"><label>TikTok link</label><input id="ttLinkInp" class="inp" placeholder="https://..."/></div>
            </div>
            <div class="two">
              <div class="fld"><label>New video (YouTube link)</label><input id="newYT" class="inp" placeholder="https://youtube.com/..."/></div>
              <div class="fld"><label>New video (Instagram/TikTok link)</label><input id="newIGTT" class="inp" placeholder="https://instagram.com/... or https://www.tiktok.com/..."/></div>
            </div>
            <div class="row">
              <button class="btn red" onclick="postVideos()">Post videos</button>
              <div class="note">Shows notification on Home.</div>
            </div>
          </div>
        </div>
      </div>

    </div>
  </section>
</div>

<footer>
  <a class="link" id="ytLinkFoot" href="#" target="_blank">
    <span class="dot"></span><span id="ytNameFoot">YouTube</span>
  </a>
  <a class="link" id="igLinkFoot" href="#" target="_blank">
    <span class="dot"></span><span id="igNameFoot">Instagram</span>
  </a>
  <a class="link" id="ttLinkFoot" href="#" target="_blank">
    <span class="dot"></span><span id="ttNameFoot">TikTok</span>
  </a>
</footer>

<!-- Game Modal -->
<div class="modal" id="gameModal" aria-hidden="true">
  <div class="sheet">
    <div class="hd">
      <div class="title" id="gameTitle">Game</div>
      <button class="x" onclick="closeGame()">Close</button>
    </div>
    <div class="bd">
      <div class="two">
        <div>
          <div class="fld">
            <label>Admin In‑Game Name</label>
            <input class="inp" id="adminGameName" value="Gladiator" readonly>
          </div>
          <div class="fld">
            <label>Admin Numeric ID</label>
            <input class="inp" id="adminGameID" value="88442211" readonly>
          </div>
        </div>
        <div>
          <div class="fld">
            <label>Your In‑Game Name</label>
            <input class="inp" id="yourGameName" placeholder="Your nickname">
          </div>
          <div class="fld">
            <label>Your Numeric ID</label>
            <input class="inp" id="yourGameID" placeholder="12345678">
          </div>
        </div>
      </div>
      <div class="fld">
        <label>Message to Admin</label>
        <textarea class="txt" id="yourMsg" placeholder="Let’s play tonight? Mode, time, etc."></textarea>
      </div>
      <div class="row">
        <button class="btn red" onclick="requestPlay()">Send Play Request</button>
        <div class="note" id="gameNote"></div>
      </div>
    </div>
  </div>
</div>

<script>
/* =========================
   Simple state + storage
========================= */
const st = {
  user: null,       // {name, phone, role:'admin'|'user'}
  otpCode: null,    // generated code for demo
  adminUnlocked: false,
  socials: {
    ytName:"YouTube", ytLink:"#",
    igName:"Instagram", igLink:"#",
    ttName:"TikTok", ttLink:"#"
  },
  inbox: [],        // {from, phone, ts, subj, body}
  music: [],        // {name, url}
  posted: false     // whether admin posted new videos (for notification)
};
// Load from localStorage
(function load(){
  try{
    const u = localStorage.getItem("glad_user");
    if(u) st.user = JSON.parse(u);
    const s = localStorage.getItem("glad_socials");
    if(s) st.socials = JSON.parse(s);
    const i = localStorage.getItem("glad_inbox");
    if(i) st.inbox = JSON.parse(i);
    const m = localStorage.getItem("glad_music");
    if(m) st.music = JSON.parse(m);
    const p = localStorage.getItem("glad_posted");
    if(p) st.posted = JSON.parse(p);
  }catch(e){}
})();

/* =========================
   Nav (icons -> tabs)
========================= */
const tabs = ["home","about","ai","music","contact","account"];
function setTab(id){
  tabs.forEach(t=>{
    document.getElementById(t).classList.remove("active");
    const btn = document.querySelector(`[data-tab="${t}"]`);
    if(btn) btn.classList.remove("active");
  });
  document.getElementById(id).classList.add("active");
  const cur = document.querySelector(`[data-tab="${id}"]`);
  if(cur) cur.classList.add("active");
  // guards
  if((id==="ai" || id==="music" || id==="contact") && !st.user){
    noteToast("Please sign in first.");
  }
  refreshLocks();
}
document.querySelectorAll(".icon-btn").forEach(b=>{
  b.addEventListener("click",()=> setTab(b.dataset.tab));
});
setTab("home");

/* =========================
   Splash
========================= */
setTimeout(()=>{ document.getElementById("splash").style.display="none"; }, 1200);

/* =========================
   Social links + notice
========================= */
function refreshSocials(){
  const {ytName, ytLink, igName, igLink, ttName, ttLink} = st.socials;
  // home row
  byId("ytName").textContent = ytName;
  byId("igName").textContent = igName;
  byId("ytLink").href = ytLink || "#";
  byId("igLink").href = igLink || "#";
  const ttA = byId("ttLink"); const ttN = byId("ttName");
  ttN.textContent = ttName; ttA.href = ttLink || "#";
  byId("videoNoticeRow").style.display = st.posted ? "flex":"none";
  // footer
  byId("ytNameFoot").textContent = ytName;
  byId("igNameFoot").textContent = igName;
  byId("ttNameFoot").textContent = ttName;
  byId("ytLinkFoot").href = ytLink || "#";
  byId("igLinkFoot").href = igLink || "#";
  byId("ttLinkFoot").href = ttLink || "#";
}
refreshSocials();

/* =========================
   Game cards
========================= */
let currentGame = null;
function openGame(name){
  currentGame = name;
  byId("gameTitle").textContent = name;
  byId("gameModal").classList.add("show");
  byId("gameNote").textContent = "";
}
function closeGame(){
  byId("gameModal").classList.remove("show");
  currentGame = null;
}
function shareGame(name){
  alert("Share: " + name);
}
function requestPlay(){
  if(!st.user){
    byId("gameNote").textContent = "Sign in first (Account icon).";
    return;
  }
  const youN = byId("yourGameName").value.trim();
  const youI = byId("yourGameID").value.trim();
  const msg  = byId("yourMsg").value.trim();
  if(!youN || !youI){
    byId("gameNote").textContent = "Enter your name and numeric ID.";
    return;
  }
  const subj = `[${currentGame}] Play request from ${youN} (${youI})`;
  st.inbox.unshift({from: st.user.name, phone: st.user.phone, ts: Date.now(), subj, body: msg || "Let's play!"});
  localStorage.setItem("glad_inbox", JSON.stringify(st.inbox));
  renderInbox();
  byId("gameNote").textContent = "Request sent.";
}

/* =========================
   Contact (messages)
========================= */
function sendMessage(){
  const subj = byId("msgSubj").value.trim();
  const body = byId("msgBody").value.trim();
  if(!st.user){ setTab("account"); byId("msgNote").textContent = "Sign in first."; return; }
  if(!subj || !body){ byId("msgNote").textContent = "Fill subject and message."; return; }
  st.inbox.unshift({from: st.user.name, phone: st.user.phone, ts: Date.now(), subj, body});
  localStorage.setItem("glad_inbox", JSON.stringify(st.inbox));
  renderInbox();
  byId("msgSubj").value = "";
  byId("msgBody").value = "";
  byId("msgNote").textContent = "Message sent.";
}
function renderInbox(){
  const box = byId("inbox");
  box.innerHTML = "";
  st.inbox.forEach(m=>{
    const d = new Date(m.ts);
    const el = document.createElement("div");
    el.className = "msg";
    el.innerHTML = `<div style="font-weight:700">${escapeHtml(m.subj)}</div>
      <div class="muted">${d.toLocaleString()} • From: ${escapeHtml(m.from)} (${escapeHtml(m.phone)})</div>
      <div style="margin-top:6px">${escapeHtml(m.body)}</div>`;
    box.appendChild(el);
  });
}
renderInbox();

/* =========================
   Account + OTP + Admin code
========================= */
function sendOTP(){
  const ph = byId("accPhone").value.trim();
  if(!ph){ byId("otpSentNote").textContent = "Enter phone first."; return; }
  const code = Math.floor(1000 + Math.random()*9000).toString();
  st.otpCode = code;
  byId("otpSentNote").textContent = "Test OTP (for demo): " + code;
}
function verifyOTP(){
  const code = byId("accOTP").value.trim();
  const name = byId("accName").value.trim() || "Player";
  const phone = byId("accPhone").value.trim();
  const adminCode = byId("accAdminCode").value.trim();
  if(!st.otpCode){ byId("accNote").textContent = "Send code first."; return; }
  if(code !== st.otpCode){ byId("accNote").textContent = "Invalid code."; return; }
  const isAdmin = (adminCode.toLowerCase() === "vortex");
  st.user = {name, phone, role: isAdmin ? "admin":"user"};
  st.adminUnlocked = isAdmin;
  localStorage.setItem("glad_user", JSON.stringify(st.user));
  byId("accNote").textContent = "Signed in as " + name + (isAdmin ? " (admin)":"");
  st.otpCode = null;
  refreshLocks();
}

/* =========================
   Admin panel (links + posts)
========================= */
function refreshLocks(){
  // admin panel visibility
  const ap = byId("adminPanel");
  const an = byId("adminNote");
  if(st.user && st.user.role==="admin"){
    ap.style.display = "block";
    an.textContent = "Admin unlocked.";
    // preload fields
    byId("ytNameInp").value = st.socials.ytName;
    byId("ytLinkInp").value = st.socials.ytLink;
    byId("igNameInp").value = st.socials.igName;
    byId("igLinkInp").value = st.socials.igLink;
    byId("ttNameInp").value = st.socials.ttName;
    byId("ttLinkInp").value = st.socials.ttLink;
    byId("musicAdmin").style.display = "block";
  }else{
    ap.style.display = "none";
    an.textContent = "Locked (sign in as admin using code “vortex”).";
    byId("musicAdmin").style.display = "none";
  }
  // feature guards
  byId("sendAI").disabled = !st.user;
  byId("aiInput").disabled = !st.user;
  byId("musicNote").textContent = st.user ? "" : "Sign in to view the list.";
  renderMusic();
}
function postVideos(){
  if(!(st.user && st.user.role==="admin")) return;
  const ytName = byId("ytNameInp").value.trim() || "YouTube";
  const ytLink = byId("ytLinkInp").value.trim() || "#";
  const igName = byId("igNameInp").value.trim() || "Instagram";
  const igLink = byId("igLinkInp").value.trim() || "#";
  const ttName = byId("ttNameInp").value.trim() || "TikTok";
  const ttLink = byId("ttLinkInp").value.trim() || "#";
  st.socials = {ytName, ytLink, igName, igLink, ttName, ttLink};
  localStorage.setItem("glad_socials", JSON.stringify(st.socials));
  st.posted = true;
  localStorage.setItem("glad_posted", JSON.stringify(true));
  refreshSocials();
  alert("Gladiator posted new videos. A notice is shown on Home.");
}

/* =========================
   Music (admin upload, all users listen)
========================= */
function addMusic(){
  if(!(st.user && st.user.role==="admin")){ alert("Admin only."); return; }
  const f = byId("musicFile").files[0];
  if(!f){ alert("Choose an audio file."); return; }
  const url = URL.createObjectURL(f);
  const name = f.name;
  st.music.unshift({name, url});
  localStorage.setItem("glad_music", JSON.stringify(st.music));
  renderMusic();
}
function renderMusic(){
  const list = byId("musicList");
  list.innerHTML = "";
  if(!st.user){ return; }
  st.music.forEach((m, i)=>{
    const wrap = document.createElement("div");
    wrap.className="song";
    wrap.innerHTML = `<div class="name">${escapeHtml(m.name)}</div>
      <div style="display:flex; gap:8px; align-items:center">
        <audio controls src="${m.url}" style="height:28px"></audio>
        <a href="${m.url}" download>Download</a>
      </div>`;
    list.appendChild(wrap);
  });
}

/* =========================
   AI — strong offline bot
========================= */
function quickAI(text){
  byId("aiInput").value = text;
  sendAIMessage();
}
byId("sendAI").addEventListener("click", sendAIMessage);
byId("aiInput").addEventListener("keydown", (e)=>{
  if(e.key==="Enter"){ e.preventDefault(); sendAIMessage(); }
});
function sendAIMessage(){
  if(!st.user){ setTab("account"); byId("aiNote").textContent="Sign in first."; return; }
  const q = byId("aiInput").value.trim();
  if(!q) return;
  byId("aiInput").value = "";
  addBubble("You", q);
  // generate reply
  const a = aiReply(q);
  setTimeout(()=> addBubble("AI", a, true), 120);
}
function addBubble(who, txt, isAI=false){
  const box = byId("chatBox");
  const b = document.createElement("div");
  b.className="bubble";
  const name = `<div class="who ${isAI?'ai-tag':''}">${who}</div>`;
  b.innerHTML = `${name}<div style="margin-top:6px; white-space:pre-wrap">${escapeHtml(txt)}</div>`;
  box.appendChild(b);
  b.scrollIntoView({behavior:"smooth", block:"end"});
}
function aiReply(q){
  const s = q.trim();
  const low = s.toLowerCase();
  const isFa = /[\u0600-\u06FF]/.test(s);
  const now = new Date();
  const timeStr = now.toLocaleTimeString();
  const dateStr = now.toLocaleDateString();

  // greetings
  if(/^(hi|hello|hey)\b/.test(low)) return "Hello! Need tips, schedule, or anything else?";
  if(/^(سلام|درود|س|سلام علیک)/.test(s)) return "سلام! چطوری رفیق؟ درباره بازی‌ها، برنامه، یا هرچی بپرس 😉";

  // how are you
  if(/(how are you|how r u|how's it going)/.test(low)) return "I’m good and ready to play. How about you?";
  if(/(چطوری|حالت|حالِت|چه خبر)/.test(s)) return "منم خوبم، آماده بازی و کمک. تو خوبی؟";

  // time / date
  if(/(time|what time|schedule)/.test(low)) return `Right now it's ${timeStr}. Propose a time and I’ll confirm.`;
  if(/(ساعت|زمان|برنامه|کی بازی)/.test(s)) return `الان ${timeStr} ـه. یه زمان بده هماهنگ کنیم.`;
  if(/date/.test(low) || /(تاریخ|امروز)/.test(s)) return isFa ? `امروز ${dateStr} هست.` : `Today is ${dateStr}.`;

  // games
  if(/cod|call of duty/.test(low)) return "COD Mobile: prefer MP ranked & BR. Drop your ID and region.";
  if(/pubg/.test(low)) return "PUBG Mobile: IGL or support? We can try split or stack depending on circle.";
  if(/delta/.test(low)) return "Delta Force: tactical comms, slow push, watch angles.";
  if(/(کالاف|کالاف دیوتی)/.test(s)) return "کالاف: معمولا MP رنک و BR می‌زنم. آیدی و ریجن رو بفرست.";
  if(/(پابجی|پابجی موبایل)/.test(s)) return "پابجی: اسکواد بهتره، بسته به سیف/هات دراپ هماهنگ می‌کنیم.";
  if(/دلتا/.test(s)) return "دلتا فورس: آروم و تاکتیکی، اسموک و کاور رو فراموش نکن.";

  // general advice
  if(/tips|advice|help/.test(low)) return "Warm-up 10 min, fix sensitivity, focus on crosshair placement, review VODs weekly.";
  if(/(نکته|راهنمایی|کمک)/.test(s)) return "۱۰ دقیقه وارم‌آپ، حساسیت ثابت، هدلاینینگ، ویدیو‌هات رو هفتگی مرور کن.";

  // join / id
  if(/(add|join|id|my id)/.test(low) || /(آیدی|اضافه کن|جوین)/.test(s))
    return isFa ? "آیدی عددی و اسم داخل بازی رو بفرست تا جوینت کنم." : "Send your in‑game name & numeric ID and I’ll add you.";

  // fallback
  return isFa
    ? "گرفتم! کمی بیشتر توضیح می‌دی چی می‌خوای؟ درباره بازی‌ها، زمان‌بندی، یا هر موضوعی بپرس."
    : "Got it! Tell me a bit more—games, timing, or anything you need.";
}

/* =========================
   Utilities
========================= */
function byId(id){ return document.getElementById(id); }
function escapeHtml(str){
  return String(str).replace(/[&<>"']/g, s=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;', "'":'&#39;' }[s]));
}
function noteToast(msg){
  // simple inline notice
  alert(msg);
}

/* =========================
   Home social refresh on load
========================= */
refreshSocials();

/* =========================
   Keyboard hotkeys (fixed)
   - Do nothing if typing in input/textarea
========================= */
document.addEventListener("keydown",(e)=>{
  const tag = document.activeElement.tagName.toLowerCase();
  if(tag === "input" || tag === "textarea") return; // <— FIX: ignore while typing
  if(e.key==="1") setTab("home");
  if(e.key==="2") setTab("about");
  if(e.key==="3") setTab("ai");
  if(e.key==="4") setTab("music");
  if(e.key==="5") setTab("contact");
  if(e.key==="6") setTab("account");
});

/* =========================
   Music + Admin + Inbox initial
========================= */
refreshLocks();
renderInbox();

/* =========================
   Game Modal close on bg click
========================= */
byId("gameModal").addEventListener("click",(e)=>{
  if(e.target.id==="gameModal") closeGame();
});
</script>
</body>
</html>
