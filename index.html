<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />
<title>GLADIATOR</title>
<style>
:root{
  --bg:#0b0b0f; --bg-soft:#111119; --panel:#141420; --ink:#e8e8f0; --muted:#a6a6b3;
  --red:#ff1f3d; --red2:#ff3b58; --line:#1f2030; --chip:#171729;
}
*{box-sizing:border-box} html,body{height:100%;margin:0;background:var(--bg);color:var(--ink);font-family:IRANSans,system-ui,Segoe UI,Roboto,Arial}
body::before,body::after{content:"";position:fixed;z-index:0;width:46vmin;height:46vmin;background:
  radial-gradient(closest-side,rgba(255,31,61,.35),transparent 60%),
  conic-gradient(from 0deg,rgba(255,80,100,.35),transparent 40%,rgba(255,31,61,.6),transparent 70%);
filter:blur(18px) saturate(140%);animation:arc 8s linear infinite;pointer-events:none}
body::before{top:-10vmin;left:-12vmin} body::after{bottom:-12vmin;right:-10vmin;animation-direction:reverse}
@keyframes arc{to{transform:rotate(360deg)}}

.app{position:relative;min-height:100%;padding:88px 16px 90px;isolation:isolate}
header{position:fixed;top:0;left:0;right:0;height:72px;background:linear-gradient(180deg,#12121a,#0d0d14);border-bottom:1px solid var(--line);
  display:flex;align-items:center;justify-content:center;z-index:10}
.nav{position:absolute;inset:0;display:flex;align-items:center;justify-content:space-between;padding:0 12px}
.brand{position:absolute;left:50%;transform:translateX(-50%);font-weight:900;letter-spacing:.28em;font-size:20px;text-shadow:0 0 18px rgba(255,47,74,.35)}
.icon-btn{width:52px;height:52px;border-radius:14px;border:1px solid var(--line);background:linear-gradient(180deg,#161621,#11111a);
  display:grid;place-items:center;cursor:pointer;transition:.15s;box-shadow:inset 0 0 0 1px rgba(255,47,74,.08)}
.icon-btn:active{transform:scale(.96)} .icon-btn.active{outline:2px solid rgba(255,47,74,.55);box-shadow:0 0 0 6px rgba(255,47,74,.08) inset}
.icon{width:26px;height:26px;fill:none;stroke:#ff4b63;stroke-width:2.2}

.grid{display:grid;gap:18px;max-width:980px;margin:0 auto}
.cards{display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:18px}
.card{background:linear-gradient(180deg,#151522,#11111a);border:1px solid var(--line);border-radius:18px;overflow:hidden;
  box-shadow:0 8px 30px rgba(0,0,0,.3),inset 0 0 0 1px rgba(255,47,74,.05)}
.card-body{padding:16px}
.title{font-weight:900;letter-spacing:.12em;font-size:20px}
.muted{color:var(--muted);font-size:13px;margin-top:6px}
.row{display:flex;gap:10px;align-items:center;margin-top:12px}
.btn{padding:10px 14px;border-radius:12px;border:1px solid var(--line);background:linear-gradient(180deg,#1a1a28,#131320);color:#fff;font-weight:800;letter-spacing:.06em;cursor:pointer}
.btn.red{background:linear-gradient(180deg,#ff2347,#e41836);border-color:#c20f29;box-shadow:0 4px 18px rgba(255,35,71,.35)}
section{display:none} section.active{display:block}
.list{display:grid;gap:10px} .msg{background:linear-gradient(180deg,#141425,#101018);border:1px solid var(--line);border-radius:14px;padding:10px 12px}

footer{position:fixed;bottom:0;left:0;right:0;height:72px;display:flex;align-items:center;justify-content:center;gap:14px;border-top:1px solid var(--line);
  background:linear-gradient(180deg,#0f0f16,#0b0b11);z-index:9}
.link{display:flex;gap:8px;align-items:center;padding:8px 12px;border-radius:999px;border:1px solid var(--line);background:#12121c;color:#fff;text-decoration:none;font-size:13px}
.dot{width:10px;height:10px;border-radius:50%;background:var(--red);box-shadow:0 0 10px rgba(255,47,74,.9)}
.fab{position:fixed;right:14px;z-index:12;width:58px;height:58px;border-radius:50%;border:1px solid var(--line);background:#151525;
  display:grid;place-items:center;box-shadow:0 10px 26px rgba(0,0,0,.35),inset 0 0 0 1px rgba(255,47,74,.06);cursor:pointer}
#fabAI{top:40%} #fabMusic{top:52%}
.fab span{font-weight:900;letter-spacing:.06em}
.splash{position:fixed;inset:0;display:grid;place-items:center;background:radial-gradient(1200px 700px at 50% 80%,rgba(255,47,74,.08),transparent),#0a0a0e;z-index:30}
.sp-title{font-size:36px;font-weight:900;letter-spacing:.25em;color:#ff304b;text-shadow:0 0 20px rgba(255,50,80,.55)}
.spinner{margin-top:14px;width:62px;height:62px;border-radius:50%;border:3px solid rgba(255,47,74,.35);border-top-color:#ff2f4a;animation:spin 1.1s linear infinite}
@keyframes spin{to{transform:rotate(360deg)}}

/* fields */
.fld{display:grid;gap:8px;margin:10px 0}
.fld label{font-size:13px;color:var(--muted)}
.inp,.txt{width:100%;background:#10101a;color:#fff;border:1px solid var(--line);padding:12px;border-radius:12px}
.txt{min-height:90px;resize:vertical}
.two{display:grid;grid-template-columns:1fr 1fr;gap:10px}
.note{color:var(--muted);font-size:12px}

/* audio toggle (speaker) */
#soundToggle{position:fixed;left:14px;bottom:88px;z-index:12}
.spk{width:48px;height:48px;border-radius:50%;border:1px solid var(--line);background:#17172a;display:grid;place-items:center;cursor:pointer}

/* small */
@media (max-width:540px){.title{font-size:18px}}
</style>
</head>
<body>

<!-- Splash -->
<div class="splash" id="splash">
  <div style="text-align:center">
    <div class="sp-title">hello spartan</div>
    <div class="spinner"></div>
  </div>
</div>

<!-- FABs -->
<button id="fabAI" class="fab" title="هوش مصنوعی"><span>AI</span></button>
<button id="fabMusic" class="fab" title="موزیک"><span>♫</span></button>
<button id="soundToggle" class="spk" title="صدا">
  <svg width="22" height="22" viewBox="0 0 24 24" stroke="#ff4b63" fill="none" stroke-width="2">
    <path d="M3 10h4l4-3v10l-4-3H3z"/><path id="wave" d="M16 8a5 5 0 0 1 0 8"/>
  </svg>
</button>

<header>
  <div class="nav">
    <div style="display:flex;gap:10px">
      <button class="icon-btn" data-tab="home" title="خانه"><svg class="icon" viewBox="0 0 24 24"><path d="M3 10.5 12 3l9 7.5M6 9.5V21h12V9.5"/></svg></button>
      <button class="icon-btn" data-tab="about" title="درباره"><svg class="icon" viewBox="0 0 24 24"><circle cx="12" cy="12" r="9"/><path d="M12 8.5h.01M11 12h1v4"/></svg></button>
    </div>
    <div class="brand">G L A D I A T O R</div>
    <div style="display:flex;gap:10px">
      <button class="icon-btn" data-tab="music" title="موزیک"><svg class="icon" viewBox="0 0 24 24"><path d="M9 18a3 3 0 1 0 0-6 3 3 0 0 0 0 6zM13 6l7-2v11"/></svg></button>
      <button class="icon-btn" data-tab="account" title="حساب"><svg class="icon" viewBox="0 0 24 24"><circle cx="12" cy="8" r="4"/><path d="M4 21a8 8 0 0 1 16 0"/></svg></button>
    </div>
  </div>
</header>

<div class="app">
  <!-- خانه -->
  <section id="home" class="active">
    <div class="grid">
      <div class="cards">
        <!-- فقط اسمِ بازی‌ها -->
        <div class="card">
          <div class="card-body">
            <div class="title" style="font-size:26px;text-shadow:0 0 18px rgba(255,47,74,.35)">CALL OF DUTY MOBILE</div>
            <div class="muted">Competitive FPS</div>
            <div class="row">
              <button class="btn red" onclick="openGame('Call of Duty Mobile')">باز کردن</button>
            </div>
          </div>
        </div>
        <div class="card">
          <div class="card-body">
            <div class="title" style="font-size:26px;text-shadow:0 0 18px rgba(255,47,74,.35)">DELTA FORCE</div>
            <div class="muted">Tactical classic</div>
            <div class="row"><button class="btn red" onclick="openGame('Delta Force')">باز کردن</button></div>
          </div>
        </div>
        <div class="card">
          <div class="card-body">
            <div class="title" style="font-size:26px;text-shadow:0 0 18px rgba(255,47,74,.35)">PUBG MOBILE</div>
            <div class="muted">Battle Royale</div>
            <div class="row"><button class="btn red" onclick="openGame('PUBG Mobile')">باز کردن</button></div>
          </div>
        </div>
      </div>

      <div class="row" id="videoNoticeRow" style="display:none">
        <div class="note">Gladiator ویدیو جدید گذاشت • پلتفرم را انتخاب کن:</div>
        <a class="link" id="ytLink" target="_blank"><span class="dot"></span><span id="ytName">YouTube</span></a>
        <a class="link" id="igLink" target="_blank"><span class="dot"></span><span id="igName">Instagram</span></a>
        <a class="link" id="ttLink" target="_blank"><span class="dot"></span><span id="ttName">TikTok</span></a>
      </div>
    </div>
  </section>

  <!-- درباره + AI -->
  <section id="about">
    <div class="grid">
      <div class="card"><div class="card-body">
        <div class="title">درباره GLADIATOR</div>
        <p class="muted">آپلود روزانه، همکاری، اسکواد پلی. فقط اکانت‌های تأیید‌شده می‌توانند درخواست بازی و پیام ارسال کنند.</p>
      </div></div>

      <div class="card" id="aiPanel"><div class="card-body">
        <div class="title">هوش مصنوعی (فارسی/English)</div>
        <p class="muted">برای دانش عمومی، «موضوع» را بنویس؛ خلاصهٔ ویکی‌پدیا می‌آید. مثال: «ویکی پلنگ برفی».</p>
        <div class="fld"><label>پیام شما</label><textarea id="aiIn" class="txt" placeholder="سؤال یا موضوع…"></textarea></div>
        <div class="row">
          <button class="btn red" onclick="askAI()">ارسال</button>
          <button class="btn" onclick="clearAI()">پاک کردن</button>
        </div>
        <div id="aiOut" class="list" style="margin-top:12px"></div>
      </div></div>
    </div>
  </section>

  <!-- موزیک -->
  <section id="music">
    <div class="grid">
      <div class="card"><div class="card-body">
        <div class="title">Music</div>
        <p class="muted">برای گوش‌دادن باید وارد شوید. فقط ادمین می‌تواند آپلود یا حذف کند. (پس‌زمینه PS4 را هم از اینجا بده)</p>
        <div class="two">
          <div class="fld"><label>انتخاب فایل صوتی</label><input id="musicFile" type="file" accept="audio/*"></div>
          <div class="fld"><label>—</label><button class="btn red" onclick="addMusic()">Upload</button></div>
        </div>
        <div class="two">
          <div class="fld"><label>لینک صدای پس‌زمینه (اختیاری)</label><input id="bgAudioUrl" class="inp" placeholder="https://..."></div>
          <div class="fld"><label>—</label><button class="btn" onclick="setBgAudio()">Set BG</button></div>
        </div>
        <div id="musicList" class="list" style="margin-top:12px"></div>
      </div></div>
    </div>
  </section>

  <!-- تماس -->
  <section id="contact" style="display:none">
    <!-- (اگر لازم شد می‌تونی برگردونی) -->
  </section>

  <!-- اکانت -->
  <section id="account">
    <div class="grid">
      <div class="card"><div class="card-body">
        <div class="title">ساخت/ورود</div>
        <div class="fld"><label>شماره موبایل</label><input id="accPhone" class="inp" placeholder="+98..." inputmode="tel"></div>
        <div class="row"><button class="btn" onclick="sendOTP()">ارسال کُد</button><div class="note" id="otpSentNote"></div></div>
        <div class="two">
          <div class="fld"><label>کُد یکبارمصرف</label><input id="accOTP" class="inp" placeholder="4 رقم" maxlength="6" inputmode="numeric"></div>
          <div class="fld"><label>نام نمایشی</label><input id="accName" class="inp" placeholder="gamer name"></div>
        </div>
        <div class="fld"><label>کلید ویژه (فقط ادمین)</label><input id="specialKey" class="inp" placeholder="اختیاری"></div>
        <div class="fld"><label>رمز ادمینِ دلخواهت</label><input id="adminPass" class="inp" placeholder="هر متنی؛ فقط برای همین نشست"></div>
        <div class="row"><button class="btn red" onclick="verifyOTP()">ورود</button><div class="note" id="accNote"></div></div>
      </div></div>

      <div class="card"><div class="card-body">
        <div class="title">پنل ادمین</div>
        <div id="adminLocked" class="note">برای باز شدن پنل، شرایط ادمین باید برقرار باشد.</div>
        <div id="adminPanel" style="display:none">
          <div class="two">
            <div class="fld"><label>YouTube name</label><input id="ytNameInp" class="inp" placeholder="YouTube"></div>
            <div class="fld"><label>YouTube link</label><input id="ytLinkInp" class="inp" placeholder="https://..."></div>
          </div>
          <div class="two">
            <div class="fld"><label>Instagram name</label><input id="igNameInp" class="inp" placeholder="Instagram"></div>
            <div class="fld"><label>Instagram link</label><input id="igLinkInp" class="inp" placeholder="https://..."></div>
          </div>
          <div class="two">
            <div class="fld"><label>TikTok name</label><input id="ttNameInp" class="inp" placeholder="TikTok"></div>
            <div class="fld"><label>TikTok link</label><input id="ttLinkInp" class="inp" placeholder="https://..."></div>
          </div>
          <div class="row"><button class="btn red" onclick="postVideos()">ثبت لینک‌ها / اعلان</button><div class="note">در خانه اعلان نمایش داده می‌شود.</div></div>
        </div>
      </div></div>
    </div>
  </section>
</div>

<footer>
  <a class="link" id="ytLinkFoot" target="_blank"><span class="dot"></span><span id="ytNameFoot">YouTube</span></a>
  <a class="link" id="igLinkFoot" target="_blank"><span class="dot"></span><span id="igNameFoot">Instagram</span></a>
  <a class="link" id="ttLinkFoot" target="_blank"><span class="dot"></span><span id="ttNameFoot">TikTok</span></a>
</footer>

<!-- Modal بازی -->
<div id="gameModal" class="splash" style="display:none;background:rgba(0,0,0,.55)">
  <div class="card" style="max-width:680px;width:96vw">
    <div class="card-body">
      <div class="title" id="gameTitle">Game</div>
      <div class="two" style="margin-top:6px">
        <div>
          <div class="fld"><label>نام ادمین در بازی</label><input class="inp" value="Gladiator" readonly></div>
          <div class="fld"><label>آیدی عددی ادمین</label><input class="inp" value="88442211" readonly></div>
        </div>
        <div>
          <div class="fld"><label>نام شما در بازی</label><input class="inp" id="yourGameName" placeholder="nickname"></div>
          <div class="fld"><label>آیدی عددی شما</label><input class="inp" id="yourGameID" placeholder="12345678"></div>
        </div>
      </div>
      <div class="fld"><label>پیام به ادمین</label><textarea class="txt" id="yourMsg" placeholder="امشب بریم؟ مود/ساعت…"></textarea></div>
      <div class="row"><button class="btn red" onclick="requestPlay()">ارسال درخواست</button><button class="btn" onclick="closeGame()">بستن</button><div class="note" id="gameNote"></div></div>
    </div>
  </div>
</div>

<!-- پخش پس‌زمینه (PS4) -->
<audio id="bgAudio" loop></audio>

<script>
/* ========= State ========= */
const ADMIN_PHONE = "09114392359";
/* vortex — obfuscated: */
const _vk = [118,111,114,116,101,120]; const SECRET = String.fromCharCode(..._vk); // 'vortex'
const st = {
  user:null, otp:null, admin:false, adminPass:"",
  socials:{ytName:"YouTube",ytLink:"#",igName:"Instagram",igLink:"#",ttName:"TikTok",ttLink:"#"},
  inbox:[], music:[], posted:false, bgUrl:""
};
try{
  const u=localStorage.getItem("glad_user"); if(u) st.user=JSON.parse(u);
  const s=localStorage.getItem("glad_socials"); if(s) st.socials=JSON.parse(s);
  const m=localStorage.getItem("glad_music"); if(m) st.music=JSON.parse(m);
  const b=localStorage.getItem("glad_bg"); if(b) st.bgUrl=b;
}catch{}

/* ========= Tabs & FABs ========= */
const tabs=["home","about","music","account"];
function setTab(id){
  tabs.forEach(t=>{document.getElementById(t).classList.remove("active"); document.querySelector(`[data-tab="${t}"]`)?.classList.remove("active");});
  document.getElementById(id).classList.add("active");
  document.querySelector(`[data-tab="${id}"]`)?.classList.add("active");
}
document.querySelectorAll(".icon-btn").forEach(b=>b.addEventListener("click",()=>setTab(b.dataset.tab)));
document.getElementById("fabAI").onclick=()=>{setTab("about"); document.getElementById("aiIn").focus();}
document.getElementById("fabMusic").onclick=()=>setTab("music");
setTab("home");

/* ========= Splash ========= */
setTimeout(()=>document.getElementById("splash").style.display="none",1100);

/* ========= Socials / notice ========= */
function refreshSocials(){
  const {ytName,ytLink,igName,igLink,ttName,ttLink}=st.socials;
  for(const id of [["ytName","ytNameFoot",ytName],["igName","igNameFoot",igName],["ttName","ttNameFoot",ttName]]){
    document.getElementById(id[0]).textContent=id[2];
    document.getElementById(id[1]).textContent=id[2];
  }
  document.getElementById("ytLink").href=document.getElementById("ytLinkFoot").href=ytLink||"#";
  document.getElementById("igLink").href=document.getElementById("igLinkFoot").href=igLink||"#";
  document.getElementById("ttLink").href=document.getElementById("ttLinkFoot").href=ttLink||"#";
  document.getElementById("videoNoticeRow").style.display=st.posted?"flex":"none";
}
refreshSocials();

/* ========= Game modal ========= */
let currentGame=null;
function openGame(n){currentGame=n;document.getElementById("gameTitle").textContent=n;document.getElementById("gameModal").style.display="grid";document.getElementById("gameNote").textContent="";}
function closeGame(){document.getElementById("gameModal").style.display="none";currentGame=null;}
function requestPlay(){
  if(!st.user){document.getElementById("gameNote").textContent="اول وارد شو (بخش حساب).";return;}
  const youN=document.getElementById("yourGameName").value.trim();
  const youI=document.getElementById("yourGameID").value.trim();
  const msg=document.getElementById("yourMsg").value.trim()||"Let's play!";
  if(!youN||!youI){document.getElementById("gameNote").textContent="نام و آیدی خودت رو بزن.";return;}
  st.inbox.unshift({from:st.user.name,phone:st.user.phone,ts:Date.now(),subj:`[${currentGame}] ${youN} (${youI})`,body:msg});
  localStorage.setItem("glad_inbox",JSON.stringify(st.inbox));
  document.getElementById("gameNote").textContent="ارسال شد.";
}

/* ========= Account + Admin gate ========= */
function sendOTP(){
  const ph=document.getElementById("accPhone").value.trim(); if(!ph){return document.getElementById("otpSentNote").textContent="شماره را وارد کن";}
  st.otp=(1000+Math.floor(Math.random()*9000)).toString();
  document.getElementById("otpSentNote").textContent="Test OTP (demo): "+st.otp; // فقط برای تست
}
function verifyOTP(){
  const code=document.getElementById("accOTP").value.trim();
  const name=document.getElementById("accName").value.trim()||"Player";
  const phone=document.getElementById("accPhone").value.trim();
  const sk=document.getElementById("specialKey").value.trim();
  const ap=document.getElementById("adminPass").value.trim();
  if(!st.otp){return document.getElementById("accNote").textContent="اول کُد را بفرست."}
  if(code!==st.otp){return document.getElementById("accNote").textContent="کُد اشتباه است."}
  st.user={name,phone}; localStorage.setItem("glad_user",JSON.stringify(st.user));
  st.admin = (phone===ADMIN_PHONE && sk===SECRET && ap.length>0);
  st.adminPass = st.admin ? ap : "";
  document.getElementById("accNote").textContent = st.admin ? "ادمین وارد شد." : ("وارد شدی به نام "+name);
  st.otp=null;
  renderAdmin();
}
function renderAdmin(){
  const p=document.getElementById("adminPanel"), l=document.getElementById("adminLocked");
  if(st.admin){p.style.display="block";l.style.display="none";
    document.getElementById("ytNameInp").value=st.socials.ytName;
    document.getElementById("ytLinkInp").value=st.socials.ytLink;
    document.getElementById("igNameInp").value=st.socials.igName;
    document.getElementById("igLinkInp").value=st.socials.igLink;
    document.getElementById("ttNameInp").value=st.socials.ttName;
    document.getElementById("ttLinkInp").value=st.socials.ttLink;
  }else{p.style.display="none";l.style.display="block";}
}
renderAdmin();

function postVideos(){
  if(!st.admin) return;
  st.socials={
    ytName:document.getElementById("ytNameInp").value.trim()||"YouTube",
    ytLink:document.getElementById("ytLinkInp").value.trim()||"#",
    igName:document.getElementById("igNameInp").value.trim()||"Instagram",
    igLink:document.getElementById("igLinkInp").value.trim()||"#",
    ttName:document.getElementById("ttNameInp").value.trim()||"TikTok",
    ttLink:document.getElementById("ttLinkInp").value.trim()||"#"
  };
  localStorage.setItem("glad_socials",JSON.stringify(st.socials));
  st.posted=true; refreshSocials(); alert("اعلان و لینک‌ها به‌روزرسانی شد.");
}

/* ========= Music (upload/delete) ========= */
function addMusic(){
  if(!st.admin){return alert("فقط ادمین می‌تواند آپلود کند.");}
  const f=document.getElementById("musicFile").files[0]; if(!f) return alert("فایل را انتخاب کن.");
  const url=URL.createObjectURL(f); st.music.unshift({name:f.name,url});
  localStorage.setItem("glad_music",JSON.stringify(st.music)); renderMusic();
}
function delMusic(i){
  if(!st.admin) return;
  st.music.splice(i,1); localStorage.setItem("glad_music",JSON.stringify(st.music)); renderMusic();
}
function renderMusic(){
  const list=document.getElementById("musicList"); list.innerHTML="";
  st.music.forEach((m,i)=>{
    const el=document.createElement("div"); el.className="msg";
    el.innerHTML=`<div style="display:flex;justify-content:space-between;align-items:center">
      <strong>${m.name}</strong>
      ${st.admin?`<button class="btn" onclick="delMusic(${i})">حذف</button>`:""}
    </div>
    <audio controls style="width:100%;margin-top:6px" src="${m.url}"></audio>`;
    list.appendChild(el);
  });
}
renderMusic();

/* ========= Background audio (PS4 vibe) ========= */
const bg=document.getElementById("bgAudio");
if(st.bgUrl){ bg.src=st.bgUrl; }
bg.volume=0.18;
function setBgAudio(){
  if(!st.admin) return;
  const v=document.getElementById("bgAudioUrl").value.trim();
  if(v){ st.bgUrl=v; localStorage.setItem("glad_bg",v); bg.src=v; try{bg.play()}catch{} }
}
let soundOn=false;
document.getElementById("soundToggle").onclick=()=>{
  if(!bg.src){alert("اول در بخش موزیک، لینک صدای پس‌زمینه بده یا فایل پخش کن.");return;}
  if(!soundOn){ bg.play().then(()=>{soundOn=true;}).catch(()=>alert("برای فعال‌شدن صدا یکبار روی صفحه لمس کن.")); }
  else{ bg.pause(); soundOn=false; }
};

/* ========= AI with Wikipedia ========= */
async function wikiSummary(q){
  // تلاش اول: فارسی
  try{
    const t=encodeURIComponent(q.replace(/^ویکی\s*/i,"").trim());
    let r=await fetch(`https://fa.wikipedia.org/api/rest_v1/page/summary/${t}`);
    if(r.ok){const j=await r.json(); if(j.extract) return j.extract;}
  }catch{}
  // تلاش دوم: انگلیسی
  try{
    const t=encodeURIComponent(q);
    let r=await fetch(`https://en.wikipedia.org/api/rest_v1/page/summary/${t}`);
    if(r.ok){const j=await r.json(); if(j.extract) return j.extract;}
  }catch{}
  return null;
}
function addMsg(role, text){
  const box=document.getElementById("aiOut");
  const el=document.createElement("div"); el.className="msg";
  el.innerHTML=`<div style="font-weight:800">${role}</div><div style="margin-top:6px;white-space:pre-wrap">${text}</div>`;
  box.prepend(el);
}
async function askAI(){
  const q=document.getElementById("aiIn").value.trim(); if(!q) return;
  addMsg("شما", q);
  let a="";
  const s=q.toLowerCase();
  if(/^(salam|سلام)/.test(s)) a="سلام! حالت چطوره؟ چه کمکی بکنم؟";
  else if(s.includes("cod")||s.includes("کالاف")) a="در مورد Call of Duty Mobile هر چی خواستی بپرس—مود، اسلحه، تنظیمات!";
  else if(s.includes("pubg")||s.includes("پابجی")) a="پابجی موبایل: اسکواد، مپ، لوتهات و روتیشن رو می‌تونیم برنامه‌ریزی کنیم.";
  else if(s.startsWith("ویکی")||s.includes("wiki")){
    const topic=q.replace(/^ویکی/i,"").trim() || q.replace(/wiki/i,"").trim();
    const sum=await wikiSummary(topic||q);
    a = sum || "نتونستم از ویکی‌پدیا بیارم (ممکنه محدودیت مرورگر باشه). یک موضوع دقیق‌تر بده.";
  } else {
    // تلاش برای ویکی طبق موضوع آزاد
    const sum=await wikiSummary(q);
    a = sum || "در خدمتم! اگر بخوای، با «ویکی [موضوع]» خلاصهٔ ویکی‌پدیا رو میارم.";
  }
  addMsg("AI", a);
  document.getElementById("aiIn").value="";
}
function clearAI(){document.getElementById("aiIn").value="";document.getElementById("aiOut").innerHTML="";}

/* ========= Keyboard quick tabs (optional) ========= */
document.addEventListener("keydown",(e)=>{
  if(e.key==="1") setTab("home");
  if(e.key==="2") setTab("about");
  if(e.key==="3") setTab("music");
  if(e.key==="4") setTab("account");
});

/* ========= Init ========= */
function initLinks(){refreshSocials();}
initLinks();
</script>
</body>
</html>
